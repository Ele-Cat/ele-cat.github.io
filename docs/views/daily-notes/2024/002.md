# Github Actions éƒ¨ç½²é¡¹ç›®

## å‰è¨€

GitHub Actions æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰å¹³å°ï¼Œå¯ä»¥æ‰§è¡Œè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ã€‚é€šè¿‡åˆ›å»ºå·¥ä½œæµï¼Œæ–¹ä¾¿çš„å°†é¡¹ç›®éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­ã€‚

æœ¬æ•™ç¨‹å°†ä»[**çº¯é™æ€æ–‡ä»¶éƒ¨ç½²**](#_1-çº¯é™æ€æ–‡ä»¶éƒ¨ç½²)ã€[**é¡¹ç›®æ‰“åŒ…æ–‡ä»¶éƒ¨ç½²**](#_2-é¡¹ç›®æ‰“åŒ…æ–‡ä»¶éƒ¨ç½²)ã€[**sh è„šæœ¬é¡¹ç›®éƒ¨ç½²**](#_3-sh-è„šæœ¬é¡¹ç›®éƒ¨ç½²)ã€[**å…¨è‡ªåŠ¨é¡¹ç›®éƒ¨ç½²**](#_4-å…¨è‡ªåŠ¨é¡¹ç›®éƒ¨ç½²)å‡ ä¸ªæ–¹é¢å®ç° Github Actions è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ã€‚

:::danger é‡è¦æç¤º

æœ¬æ•™ç¨‹ä¸­çš„ç¤ºä¾‹é¡¹ç›®ä»£ç æ‹‰å–ä¸‹æ¥åï¼Œè¯·å°†é¡¹ç›®æ¨é€åˆ°è‡ªå·±çš„ GitHub ä»“åº“ä¸­ï¼Œä»¥ä¾¿åç»­æ“ä½œæ­¥éª¤èƒ½å¤ŸæˆåŠŸè¿è¡Œã€‚å¦‚æœæ˜¯å·²æœ‰é¡¹ç›®ï¼Œè¯·é…Œæƒ…æ‰§è¡Œéƒ¨ç½²æ­¥éª¤ï¼

:::

## 1.çº¯é™æ€æ–‡ä»¶éƒ¨ç½²

:::warning å¼•å­

çº¯é™æ€æ–‡ä»¶éƒ¨ç½²å¸¸ç”¨åœ¨**çº¯ html é¡µé¢ä¸”æ— éœ€ç¼–è¯‘æ‰“åŒ…çš„é¡¹ç›®**ä¸­ï¼Œå…¥å£ `index.html` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œå…‹éš†[Github ç¤ºä¾‹é¡¹ç›®](https://github.com/Ele-Cat/test-static-pages)ã€‚

:::

1. é¡¹ç›®ç»“æ„

```
|- test-static-pages
  - index.css
  - index.html
  - index.js
```

2. é¡¹ç›®ä»£ç 

   - index.html

     ```html
     <!DOCTYPE html>
     <html lang="en">
       <head>
         <meta charset="UTF-8" />
         <meta
           name="viewport"
           content="width=device-width, initial-scale=1.0"
         />
         <title>æµ‹è¯•é™æ€æ–‡ä»¶éƒ¨ç½²</title>
         <link rel="stylesheet" href="index.css" />
       </head>
       <body>
         æµ‹è¯•é™æ€æ–‡ä»¶éƒ¨ç½²

         <script src="index.js"></script>
       </body>
     </html>
     ```

   - index.js

     ```js
     console.log("æµ‹è¯•é™æ€æ–‡ä»¶éƒ¨ç½²");
     ```

   - index.css

     ```css
     * {
       color: red;
     }
     ```

3. é…ç½® Actionsï¼š

   - å…‹éš†å¹¶æ¨é€[é¡¹ç›®](https://github.com/Ele-Cat/test-static-pages)åˆ°è‡ªå·±çš„ GitHub ä»“åº“ä¸­ï¼›
   - æ‰“å¼€é¡¹ç›®ï¼šSettings -> Pagesï¼›
   - Source é»˜è®¤é€‰æ‹© `Deploy from a branch`ï¼›
   - Branch åˆ†æ”¯é€‰æ‹© `master` åˆ†æ”¯ã€é»˜è®¤åˆ†æ”¯åç§°åœ¨[æ­¤å¤„](https://github.com/settings/repositories)ä¿®æ”¹ã€‘ï¼›
   - Select folder é»˜è®¤é€‰æ‹© `/(root)`ï¼›
   - ç‚¹å‡» Save åï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages ä¸Šï¼Œ[è®¿é—®ç¤ºä¾‹é¡¹ç›®](https://ele-cat.github.io/test-static-pages/)ï¼›
   - æ“ä½œæ­¥éª¤å¦‚ä¸‹å›¾ï¼š

   ![é…ç½® actions](/images/1715236333939.jpg){data-zoomable}

:::warning æ³¨æ„

1. åªè¦åœ¨ `master` åˆ†æ”¯ä¸Šæ¨é€ä»£ç ï¼Œéƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ã€‚å› æ­¤å¯ä»¥å¦èµ·ä¸€ä¸ª `develop` åˆ†æ”¯å»å†™å¼€å‘å†…å®¹ï¼Œæœ‰éœ€è¦éƒ¨ç½²æ—¶ï¼Œå°† `develop` åˆ†æ”¯åˆå¹¶åˆ° `master` åˆ†æ”¯ï¼Œåˆå¹¶æˆåŠŸåä¾ç„¶ä¼šè‡ªåŠ¨éƒ¨ç½² `master` åˆ†æ”¯ã€‚
2. å¯ä»¥åœ¨é¡¹ç›®çš„ `Actions` é¡µé¢æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼Œè§‚å¯Ÿéƒ¨ç½²è¿‡ç¨‹ã€‚

:::

## 2.é¡¹ç›®æ‰“åŒ…æ–‡ä»¶éƒ¨ç½²

:::warning å¼•å­

ä¸Šå°èŠ‚å®ç°äº†çº¯é™æ€é¡µé¢çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œä½†å¯¹äºéœ€è¦ç¼–è¯‘æ‰“åŒ…çš„é¡¹ç›®æ¥è¯´ï¼Œæ‰“åŒ…å¥½çš„æ–‡ä»¶ä¼šåœ¨ `dist` ç›®å½•ä¸‹ï¼Œå¾ˆæ˜æ˜¾ä¸Šå°èŠ‚ `Select folder` æ—¶æ²¡æœ‰ `/dist` é€‰é¡¹ã€_PSï¼šå½“ç„¶æŠŠé¡¹ç›®æ‰“åŒ…ç›®å½•è®¾å®šä¸º /docs å»éƒ¨ç½²ä¹Ÿå¯ä»¥_ã€‘ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° `Actions` é‡Œçš„ `yml` é…ç½®ã€‚

é¡¹ç›®æ‰“åŒ…æ–‡ä»¶éƒ¨ç½²ï¼Œå¸¸ç”¨åœ¨ `dist` æ–‡ä»¶åœ¨æœ¬åœ°æ‰“åŒ…å¥½ï¼Œæäº¤åˆ° GitHub ä¸Šï¼Œç„¶åéƒ¨ç½²çš„åœºæ™¯ä¸­ï¼Œå…‹éš†[Github ç¤ºä¾‹é¡¹ç›®](https://github.com/Ele-Cat/test-dist-pages)ï¼Œæœ¬èŠ‚æ‰€ç”¨ç¤ºä¾‹ä¸º vite+vue3 é¡¹ç›®ï¼Œå…¶ä»–æ¡†æ¶é€»è¾‘ä¸€è‡´ã€‚

:::

1. å…‹éš†é¡¹ç›®ã€åœ¨å·²æœ‰é¡¹ç›®ä¸­ç›´æ¥è·³åˆ°ç¬¬ 3 æ­¥ã€‘ï¼š
   ```sh
   git clone https://github.com/Ele-Cat/test-dist-pages.git
   ```
2. å®‰è£…ä¾èµ–&æ‰“åŒ…
   ```sh
   npm install
   ```
   ```sh
   npm run build
   ```
3. æ¨é€é¡¹ç›®åˆ°è‡ªå·±çš„ GitHub ä»“åº“ä¸­ï¼Œæ³¨æ„æ­¤æ—¶ä¼šå°† `dist` ç›®å½•ä¹Ÿæäº¤ä¸Šå»ã€`.gitignore`æ–‡ä»¶ä¸å¿½ç•¥`dist`ç›®å½•ã€‘
4. é…ç½® Actions:

   - æ‰“å¼€é¡¹ç›®ï¼šSettings -> Pagesï¼›
   - Source é€‰æ‹© `GitHub Actions`ï¼›
   - workflow é€‰æ‹© `Static HTML` â†’ `Configure`ï¼Œä¼šè·³è½¬åˆ° `*/.github/workflows/static.yml` ç¼–è¾‘é¡µï¼›
   - ä¿®æ”¹ `static.yml`ï¼š

     ```yml
     # Simple workflow for deploying static content to GitHub Pages

     # è¿™è¡Œä»£ç è®¾ç½®äº†å·¥ä½œæµç¨‹çš„åç§°ä¸º "Deploy static content to Pages"ã€‚
     name: Deploy static content to Pages

     # è¿™éƒ¨åˆ†å®šä¹‰äº†è§¦å‘å·¥ä½œæµç¨‹æ‰§è¡Œçš„äº‹ä»¶ã€‚å®ƒæŒ‡å®šå½“ä»£ç æ¨é€åˆ°åä¸º "master" çš„åˆ†æ”¯æ—¶è§¦å‘å·¥ä½œæµç¨‹æ‰§è¡Œï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡ GitHub Actions ç•Œé¢æ‰‹åŠ¨è§¦å‘å·¥ä½œæµç¨‹ã€‚
     on:
       push:
         branches: ["master"]
       workflow_dispatch:

     # è¿™éƒ¨åˆ†è®¾ç½®äº† GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸å¯¹ GitHub Pages è¿›è¡Œéƒ¨ç½²ã€‚å®ƒæŒ‡å®š GITHUB_TOKEN å…·æœ‰è¯»å–ä»“åº“å†…å®¹ã€å†™å…¥é¡µé¢å’Œå†™å…¥èº«ä»½ä»¤ç‰Œçš„æƒé™ã€‚
     permissions:
       contents: read
       pages: write
       id-token: write

     # è¿™éƒ¨åˆ†å®šä¹‰äº†å¹¶å‘æ€§è®¾ç½®ã€‚å®ƒæŒ‡å®šä¸€ä¸ªåä¸º "pages" çš„ç»„ï¼Œç”¨äºé™åˆ¶åªèƒ½æœ‰ä¸€ä¸ªå¹¶å‘çš„é¡µé¢éƒ¨ç½²ä»»åŠ¡è¿è¡Œï¼ŒåŒæ—¶å–æ¶ˆæ’é˜Ÿä¸­çš„è¿è¡Œã€‚ä½†ä¸ä¼šå–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„è¿è¡Œï¼Œä»¥ç¡®ä¿ç”Ÿäº§éƒ¨ç½²å®Œæˆã€‚
     concurrency:
       group: "pages"
       cancel-in-progress: false

     # è¿™éƒ¨åˆ†å®šä¹‰äº†ä¸€ä¸ªåä¸º "deploy" çš„ä»»åŠ¡(job)ã€‚è¯¥ä»»åŠ¡åœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Šè¿è¡Œã€‚å®ƒåŒ…å«ä¸€ç³»åˆ—æ­¥éª¤ä»¥æ‰§è¡Œé™æ€å†…å®¹çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œå…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š
     # Checkout æ­¥éª¤ä½¿ç”¨ actions/checkout åŠ¨ä½œæ¥è·å–ä»£ç åº“ã€‚
     # Setup Pages æ­¥éª¤ä½¿ç”¨ actions/configure-pages åŠ¨ä½œè¿›è¡Œé¡µé¢é…ç½®ã€‚
     # Upload artifact æ­¥éª¤ä½¿ç”¨ actions/upload-pages-artifact åŠ¨ä½œå°† "./dist" ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸Šä¼ åˆ° GitHub Pages æ‰€éœ€çš„å­˜å‚¨åº“ã€‚
     # Deploy to GitHub Pages æ­¥éª¤ä½¿ç”¨ actions/deploy-pages åŠ¨ä½œæ‰§è¡Œå®é™…çš„ GitHub Pages éƒ¨ç½²æ“ä½œï¼Œå¹¶å°†æ“ä½œç»“æœä¿å­˜åœ¨ deployment å˜é‡ä¸­ï¼Œå¯ä»¥é€šè¿‡ ${{steps.deployment.outputs.page_url }} è®¿é—®éƒ¨ç½²åçš„é¡µé¢ URLã€‚
     jobs:
       deploy:
         environment:
           name: github-pages
           url: ${{ steps.deployment.outputs.page_url }}
         runs-on: ubuntu-latest
         steps:
           - name: Checkout
             uses: actions/checkout@v4
           - name: Setup Pages
             uses: actions/configure-pages@v5
           - name: Upload artifact
             uses: actions/upload-pages-artifact@v3
             with:
               # Upload entire repository
               path: "." // [!code --]
               path: "./dist" // [!code ++]
           - name: Deploy to GitHub Pages
             id: deployment
             uses: actions/deploy-pages@v4
     ```

   - ç‚¹å‡»å³ä¸Šè§’çš„ `Commit changes` åï¼Œå†ç‚¹å‡»å¼¹çª—çš„ `Commit changes`ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages ä¸Šï¼Œ[è®¿é—®ç¤ºä¾‹é¡¹ç›®](https://ele-cat.github.io/test-dist-pages/)ï¼›
   - æ“ä½œæ­¥éª¤å¦‚ä¸‹å›¾ï¼š
     ![é…ç½® actions](/images/1715302610472.jpg){data-zoomable}

:::warning æ³¨æ„

1. ä¸ä¸Šå°èŠ‚ä¸€æ ·ï¼Œåœ¨æ¨é€ `master` åˆ†æ”¯æ¨é€ä»»æ„ä»£ç ï¼Œåç»­æ— éœ€ä»»ä½•é…ç½®ï¼Œéƒ½ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½² `dist`ã€‚
2. æœ¬èŠ‚æ¡ˆä¾‹åœºæ™¯å¤š**ç”¨åœ¨é¡¹ç›®æ‰€éœ€ä¾èµ–ä¸ºç§æœ‰éƒ¨ç½²**ï¼Œåœ¨ GitHub ä¸­æ— æ³•è‡ªåŠ¨ `install&build`ï¼›å¦‚æœé¡¹ç›®æ‰€éœ€ä¾èµ–å¯åœ¨ GitHub ä¸Šå®Œæˆï¼Œæ›´æ¨èç”¨[å…¨è‡ªåŠ¨é¡¹ç›®éƒ¨ç½²](#_4-å…¨è‡ªåŠ¨é¡¹ç›®éƒ¨ç½²)çš„æ“ä½œã€‚

:::

## 3.sh è„šæœ¬é¡¹ç›®éƒ¨ç½²

:::warning å¼•å­

> ä¸Šå°èŠ‚ä¸­å®ç°çš„é¡¹ç›®éƒ¨ç½²è¾ƒä¸ºç¹çï¼š
>
> 1. å¼€å‘å®Œæˆåæœ¬åœ° buildï¼›
> 2. build åæäº¤æ–‡ä»¶åˆ° GitHubï¼›
> 3. ç­‰å¾… GitHub Actions éƒ¨ç½²ã€‚

> æœ¬èŠ‚é€šè¿‡ `sh` è„šæœ¬ï¼Œæ¥å®ç°ï¼š
>
> 1. é¡¹ç›®è‡ªåŠ¨æ‰“åŒ…å¹¶æ¨é€ `dist` åˆ°å¯¹åº”åˆ†æ”¯;
> 2. è‡ªåŠ¨éƒ¨ç½²ã€‚

è™½ç„¶åªç¼©å‡äº†ä¸€å°æ­¥ï¼Œä½†ä¹Ÿæ˜¯å¤§è¿›æ­¥ ğŸ‰ï¼å…‹éš†[Github ç¤ºä¾‹é¡¹ç›®](https://github.com/Ele-Cat/test-sh-pages)ï¼Œæœ¬èŠ‚æ‰€ç”¨ç¤ºä¾‹ä¸º vite+vue3 é¡¹ç›®ï¼Œå…¶ä»–æ¡†æ¶é€»è¾‘ä¸€è‡´ã€‚

:::

1. å…‹éš†é¡¹ç›®ã€åœ¨å·²æœ‰é¡¹ç›®ä¸­ç›´æ¥è·³åˆ°ç¬¬ 4 æ­¥ã€‘ï¼š
   ```sh
   git clone https://github.com/Ele-Cat/test-sh-pages.git
   ```
2. å®‰è£…ä¾èµ–
   ```sh
   npm install
   ```
3. æ¨é€é¡¹ç›®åˆ°è‡ªå·±çš„ GitHub ä»“åº“ä¸­
4. ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½• `deploy.sh` æ–‡ä»¶çš„ç¬¬ `21` è¡Œä»£ç ï¼š

   ```sh{21}
   #!/usr/bin/env sh

   set -x  # è¿™é‡Œæ˜¯ä¸ºäº†çœ‹é”™è¯¯æ—¥å¿—

   # æ‰“åŒ…é¡¹ç›®
   npm run build

   # è¿›å…¥æ‰“åŒ…åçš„æ–‡ä»¶å¤¹
   cd dist

   # åˆå§‹åŒ–ä¸€ä¸ª Git ä»“åº“ï¼Œå¦‚æœåœ¨ dist ç›®å½•ä¸­è¿˜æ²¡æœ‰ Git ä»“åº“çš„è¯ã€‚
   git init
   # æ·»åŠ æ‰€æœ‰æ›´æ”¹è¿‡çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºã€‚
   git add -A
   # æäº¤æš‚å­˜åŒºçš„æ‰€æœ‰æ›´æ”¹ï¼Œå¹¶é™„ä¸Šä¸€ä¸ªæäº¤ä¿¡æ¯ã€‚
   git commit -m 'ğŸš€è‡ªåŠ¨éƒ¨ç½²'

   # å°†å½“å‰åˆ†æ”¯å¼ºåˆ¶æ¨é€åˆ° GitHub ä¸Šçš„æŒ‡å®šåˆ†æ”¯ã€‚
   # -f é€‰é¡¹è¡¨ç¤ºå¼ºåˆ¶æ¨é€ï¼Œå®ƒä¼šè¦†ç›–è¿œç¨‹åˆ†æ”¯ä¸Šçš„ä»»ä½•æ›´æ”¹ã€‚
   # è¿™é‡Œçš„ master:sh-pages è¡¨ç¤ºå°†æœ¬åœ°çš„ master åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹çš„ sh-pages åˆ†æ”¯ã€‚
   git push -f https://github.com/Ele-Cat/test-sh-pages.git master:sh-pages
   ```

   > è¯·å°†`https://github.com/Ele-Cat/test-sh-pages.git`ä»“åº“åœ°å€ä¿®æ”¹ä¸ºè‡ªå·±çš„ä»“åº“åœ°å€ï¼Œ`master:sh-pages`åˆ†æ”¯ä¿¡æ¯ä¿®æ”¹ä¸ºè‡ªå·±ä»“åº“å¯¹åº”çš„ç›®æ ‡åˆ†æ”¯ã€‚

5. åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œå‘½ä»¤ï¼š

   ```sh
   sh deploy.sh
   ```

   > åœ¨ Windows ç”µè„‘ çš„ VSCode å‘½ä»¤è¡Œå·¥å…·ä¸­è¿è¡Œ `sh deploy.sh`ï¼Œå¯èƒ½ä¼šæŠ¥ ~~sh : æ— æ³•å°†â€œshâ€é¡¹è¯†åˆ«ä¸º cmdletã€å‡½æ•°ã€è„šæœ¬æ–‡ä»¶æˆ–å¯è¿è¡Œç¨‹åºçš„åç§°ã€‚è¯·æ£€æŸ¥åç§°çš„æ‹¼å†™ï¼Œå¦‚æœåŒ…æ‹¬è·¯å¾„ï¼Œè¯·ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚~~ è§£å†³åŠæ³•ï¼šåœ¨ `Git Bash` ä¸­è¿è¡Œè„šæœ¬å‘½ä»¤ã€‚

6. ç­‰å¾…è„šæœ¬è¿è¡Œå®Œæˆï¼Œå¯ä»¥åœ¨é¡¹ç›®ä»“åº“ä¸­çœ‹åˆ°æ–°çš„ `sh-pages` åˆ†æ”¯ã€‚
7. é…ç½® Actionsï¼š
   - æ‰“å¼€é¡¹ç›®ï¼šSettings -> Pagesï¼›
   - Source é»˜è®¤é€‰æ‹© `Deploy from a branch`ï¼›
   - Branch åˆ†æ”¯é€‰æ‹© `sh-pages` åˆ†æ”¯ã€æ³¨æ„è¿™é‡Œçš„`sh-pages`åˆ†æ”¯ä¸ºç¬¬å››æ­¥æ¨é€çš„åˆ†æ”¯åç§°ã€‘ï¼›
   - Select folder é»˜è®¤é€‰æ‹© `/(root)`ï¼›
   - ç‚¹å‡» Save åï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages ä¸Šï¼Œ[è®¿é—®ç¤ºä¾‹é¡¹ç›®](https://ele-cat.github.io/test-sh-pages/)ï¼›
   - æ“ä½œæ­¥éª¤å›¾å‚è€ƒç¬¬ä¸€å°èŠ‚ã€‚

:::warning æ³¨æ„

1. æœ¬å°èŠ‚éƒ¨ç½²æ–¹å¼æœ€ä¸ºçµæ´»ï¼Œåœ¨é `sh-pages` åˆ†æ”¯æäº¤ä»£ç æ—¶ï¼Œä¸ä¼šè§¦å‘æ‰§è¡Œé¡¹ç›®éƒ¨ç½²ï¼›åœ¨éœ€è¦é¡¹ç›®éƒ¨ç½²æ—¶ï¼Œè¿è¡Œ `sh deploy.sh` è„šæœ¬ï¼Œå³å¯å®ç°è‡ªåŠ¨éƒ¨ç½²ã€‚
2. ä½†æ˜¯é€šè¿‡ sh è„šæœ¬æ‰“åŒ…ã€æ¨é€ã€éƒ¨ç½²ï¼Œè¿˜æ˜¯éœ€è¦å¼€å‘è€…æ‰‹åŠ¨è¿è¡Œå‘½ä»¤è§¦å‘ï¼Œå¹¶éå…¨è‡ªåŠ¨ã€‚ä¸‹å°èŠ‚å°†ä»‹ç»å¦‚ä½•å®ç°ä»£ç æäº¤å³è§¦å‘å…¨è‡ªåŠ¨éƒ¨ç½²ã€‚

:::

## 4.å…¨è‡ªåŠ¨é¡¹ç›®éƒ¨ç½²

:::tip å¼•å­

å›å½’â€œå‰è¨€â€ï¼ŒGitHub Actions æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰å¹³å°ï¼Œå¯ä»¥æ‰§è¡Œè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ Actions å®ç°**ä»£ç æäº¤å³è§¦å‘å…¨è‡ªåŠ¨éƒ¨ç½²**ï¼Œå³å®‰è£…ã€æ‰“åŒ…ã€éƒ¨ç½²éƒ½åœ¨ Actions ä¸­å®Œæˆã€‚

:::

:::details ä¸€äº›åŸºç¡€æ¦‚å¿µ

1. CICDï¼ˆæŒç»­æ„å»ºã€æŒç»­äº¤ä»˜ï¼‰

   **â‘  CI æŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰**

   æŒç»­é›†æˆï¼šé¢‘ç¹çš„å°†ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¼ºè°ƒé€šè¿‡é›†æˆæµ‹è¯•åé¦ˆç»™å¼€å‘ä¸€ä¸ªç»“æœï¼Œä¸ç®¡å¤±è´¥è¿˜æ˜¯æˆåŠŸã€‚

   æŒç»­é›†æˆåˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š

   - æŒç»­é›†æˆå‡†å¤‡é˜¶æ®µï¼šæ ¹æ®è½¯ä»¶å¼€å‘çš„éœ€è¦ï¼Œå‡†å¤‡ CI çš„ä¸€äº›å‰ç½®å·¥ä½œ
     - é›†æˆ CI å·¥å…·çš„ä»£ç ä»“åº“ï¼ˆGitlabã€Githubã€Jenkins ç­‰ï¼‰
     - å•å…ƒæµ‹è¯•æˆ–è€…é›†æˆæµ‹è¯•çš„è„šæœ¬
     - è§¦å‘ CI çš„é…ç½®æ–‡ä»¶ï¼Œå®ç°å„ç§åŠŸèƒ½çš„ Jobs
   - æŒç»­é›†æˆè¿›è¡Œé˜¶æ®µ
     - æ¨é€ä»£ç å‡ºå‘ CI ç³»ç»Ÿ
     - é€šè¿‡ CI ç³»ç»Ÿç›‘å¬ä»£ç çš„æµ‹è¯•ã€æ„å»ºï¼Œåé¦ˆé›†æˆç»“æœ
     - é€šè¿‡ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿå®ç°ç‰ˆæœ¬çš„ç®¡ç†
   - æ¥ç»­é›†æˆå®Œæˆé˜¶æ®µï¼šåé¦ˆé›†æˆç»“æœ

   **â‘¡ CD æŒç»­äº¤ä»˜ï¼ˆContinuous Deliveryï¼‰**

   æŒç»­äº¤ä»˜ï¼šä¸»è¦é¢å‘æµ‹è¯•äººå‘˜å’Œäº§å“ï¼Œå¯ä»¥ä¿è¯ä¸€é”®éƒ¨ç½²ï¼Œå¸¸å¸¸è¦äº¤ä»˜çš„å†…å®¹åŒ…æ‹¬

   - æºä»£ç ï¼šç¼ºç‚¹ï¼Œä»£ç ä¾èµ–çš„ç¯å¢ƒä¸å®¹æ˜“æ§åˆ¶
   - æ‰“åŒ…çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…ç³»ç»ŸåŒ…ï¼šå­˜åœ¨å…¼å®¹æ€§é—®é¢˜å’Œç¯å¢ƒå·®å¼‚å‡ºç°çš„éƒ¨ç½²å¤±è´¥
   - è™šæ‹Ÿæœºé•œåƒäº¤ä»˜ï¼šç³»ç»Ÿéš”ç¦»æœ€å¥½ï¼Œä½†å ç”¨ç³»ç»Ÿèµ„æºä¸¥é‡
   - Docker äº¤ä»˜ï¼šå®¹å™¨äº¤ä»˜ï¼Œæˆæœ¬æœ€ä½ï¼Œå…¼å®¹æ€§æœ€å¥½

   æŒç»­éƒ¨ç½²ï¼šæ­¤æ—¶è¦æä¾›ä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ‰€éœ€çš„ç¯å¢ƒå’Œä¾èµ–ï¼Œä¸»è¦é¢å‘ç”¨æˆ·æä¾›æœåŠ¡ï¼Œå‘ç”Ÿé”™è¯¯è¦èƒ½å¿«é€Ÿå›æ»šã€‚

   CICD æ˜¯ç›®å‰å¤§å¤šæ•°äº’è”ç½‘å…¬å¸é€‰æ‹©çš„ä¸€ç§éƒ¨ç½²æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿçµæ´»é…ç½®é¡¹ç›®éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µã€‚

2. Workflowsï¼ˆå·¥ä½œæµï¼‰

   å·¥ä½œæµæ˜¯ä¸€ä¸ªå¯é…ç½®çš„è‡ªåŠ¨åŒ–çš„ç¨‹åºã€‚åˆ›å»ºä¸€ä¸ªå·¥ä½œæµï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ª YAML æ–‡ä»¶ï¼Œå½“ä½ çš„ä»“åº“è§¦å‘æŸä¸ªäº‹ä»¶çš„æ—¶å€™ï¼Œå·¥ä½œæµå°±ä¼šè¿è¡Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼Œæˆ–è€…å®šä¹‰ä¸€ä¸ªæ—¶é—´è¡¨ã€‚ä¸€ä¸ªä»“åº“å¯ä»¥åˆ›å»ºå¤šä¸ªå·¥ä½œæµï¼Œæ¯ä¸€ä¸ªå·¥ä½œæµéƒ½å¯ä»¥æ‰§è¡Œä¸åŒçš„æ­¥éª¤ã€‚

   - Events(äº‹ä»¶)

     äº‹ä»¶æ˜¯æŒ‡ä»“åº“è§¦å‘è¿è¡Œå·¥ä½œæµçš„å…·ä½“çš„è¡Œä¸ºï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ª `pull request`ã€æ–°å»ºä¸€ä¸ª `issue`ã€æˆ–è€…æ¨é€ä¸€ä¸ª `commit`ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ—¶é—´è¡¨è§¦å‘ä¸€ä¸ªå·¥ä½œæµï¼Œæˆ–è€…é€šè¿‡è¯·æ±‚ä¸€ä¸ª REST APIï¼Œå†æˆ–è€…æ‰‹åŠ¨è§¦å‘ã€‚

   - Jobs(ä»»åŠ¡)

     ä»»åŠ¡æ˜¯åœ¨åŒä¸€ä¸ªè¿è¡Œå™¨ä¸Šæ‰§è¡Œçš„ä¸€ç»„æ­¥éª¤ã€‚ä¸€ä¸ªæ­¥éª¤è¦ä¹ˆæ˜¯ä¸€ä¸ª shell è„šæœ¬è¦ä¹ˆæ˜¯ä¸€ä¸ªåŠ¨ä½œã€‚æ­¥éª¤ä¼šé¡ºåºæ‰§è¡Œï¼Œå¹¶å½¼æ­¤ç‹¬ç«‹ã€‚å› ä¸ºæ¯ä¸€ä¸ªæ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªè¿è¡Œå™¨ä¸Šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä½ å¯ä»¥ä»ä¸€ä¸ªæ­¥éª¤ä¼ é€’æ•°æ®åˆ°å¦ä¸€ä¸ªæ­¥éª¤ ã€‚

     ä½ å¯ä»¥é…ç½®ä¸€ä¸ªä»»åŠ¡ä¾èµ–å…¶ä»–ä»»åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»»åŠ¡æ²¡æœ‰ä¾èµ–ï¼Œå¹¶è¡Œæ‰§è¡Œã€‚å½“ä¸€ä¸ªä»»åŠ¡éœ€è¦å¦å¤–ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå®ƒä¼šç­‰åˆ°ä¾èµ–çš„ä»»åŠ¡å®Œæˆå†æ‰§è¡Œã€‚

   - Actions(åŠ¨ä½œ)

     åŠ¨ä½œæ˜¯ GitHub Actions å¹³å°çš„ä¸€ä¸ªè‡ªå®šä¹‰çš„åº”ç”¨ï¼Œå®ƒä¼šæ‰§è¡Œä¸€ä¸ªå¤æ‚ä½†æ˜¯éœ€è¦é¢‘ç¹é‡å¤çš„ä½œä¸šã€‚ä½¿ç”¨åŠ¨ä½œå¯ä»¥å‡å°‘é‡å¤ä»£ç ã€‚æ¯”å¦‚ä¸€ä¸ª action å¯ä»¥å®ç°ä» GitHub æ‹‰å–ä½ çš„ git ä»“åº“ï¼Œä¸ºä½ çš„æ„å»ºç¯å¢ƒåˆ›å»ºåˆé€‚çš„å·¥å…·é“¾ç­‰ã€‚ä½ å¯ä»¥å†™è‡ªå·±çš„åŠ¨ä½œ ï¼Œæˆ–è€…åœ¨ GitHub å¸‚åœºæ‰¾å·²ç»å®ç°å¥½çš„åŠ¨ä½œã€‚

   - Runners(è¿è¡Œå™¨)

     ä¸€ä¸ªè¿è¡Œå™¨æ˜¯ä¸€ä¸ªå¯ä»¥è¿è¡Œå·¥ä½œæµçš„æœåŠ¡ã€‚æ¯ä¸€ä¸ªè¿è¡Œå™¨ä¸€æ¬¡åªè¿è¡Œä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ã€‚GitHub æä¾› Ubuntu Linuxï¼ŒMicrosoft Windows å’Œ macOS è¿è¡Œå™¨ï¼Œæ¯ä¸€ä¸ªå·¥ä½œæµéƒ½è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹æ–°å»ºçš„è™šæ‹Ÿæœºä¸­ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿è¡Œå™¨ã€‚

:::

1. å…‹éš†é¡¹ç›®ã€åœ¨å·²æœ‰é¡¹ç›®ä¸­ç›´æ¥è·³åˆ°ç¬¬ 2 æ­¥ã€‘ï¼š
   ```sh
   git clone https://github.com/Ele-Cat/test-auto-pages.git
   ```
2. æ¨é€é¡¹ç›®åˆ°è‡ªå·±çš„ GitHub ä»“åº“ä¸­

   - å¦‚æœç”¨çš„æ˜¯å…‹éš†é¡¹ç›®ï¼Œç›´æ¥æ¨é€å³å¯
   - å¦‚æœæ˜¯è‡ªå·±çš„å…¨æ–°é¡¹ç›®ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å¢ `.github/workflows/auto-deploy.yml`æ–‡ä»¶ï¼š

     ```yml
     # .github/workflows/auto-deploy.yml

     name: auto deploy ğŸš€

     on:
       # ç›‘å¬pushæ“ä½œ
       push:
         branches:
           - master # è¿™é‡Œåªé…ç½®äº†masteråˆ†æ”¯ï¼Œæ‰€ä»¥åªæœ‰æ¨é€masteråˆ†æ”¯æ‰ä¼šè§¦å‘ä»¥ä¸‹ä»»åŠ¡
       pull_request:

       # è¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿ä½ æ‰‹åŠ¨åœ¨ Action tab é¡µé¢è§¦å‘å·¥ä½œæµ
       workflow_dispatch:

     permissions:
       # å…è®¸å¯¹ä»“åº“çš„å†…å®¹è¿›è¡Œå†™æ“ä½œã€‚åŒ…æ‹¬åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤æ–‡ä»¶ã€ç›®å½•ä»¥åŠæäº¤æ›´æ”¹ç­‰
       # è¿™é‡Œåªé…ç½®äº†pushï¼Œæ‰€ä»¥åªæœ‰æ¨é€masteråˆ†æ”¯æ‰ä¼šè§¦å‘ä»¥ä¸‹ä»»åŠ¡
       contents: write
       # å…è®¸ç®¡ç† GitHub Pages æœåŠ¡å¹¶å¯¹å…¶è¿›è¡Œå†™æ“ä½œ
       pages: write

     jobs:
       # ä»»åŠ¡ID
       build-and-deploy:
         # è¿è¡Œç¯å¢ƒ
         runs-on: ubuntu-latest
         concurrency:
           group: ${{ github.workflow }}-${{ github.ref }}

         # æ­¥éª¤
         steps:
           # å®˜æ–¹actionï¼Œå°†ä»£ç æ‹‰å–åˆ°è™šæ‹Ÿæœº
           - name: Checkout
             uses: actions/checkout@v3

           # å®‰è£…ä¾èµ–
           - name: Install dependencies
             run: npm install
           # æ‰“åŒ…
           - name: Build application ğŸ”§
             run: npm run build

           # éƒ¨ç½²
           - name: Deploy ğŸš€
             uses: JamesIves/github-pages-deploy-action@v4
             if: github.ref == 'refs/heads/master'
             with:
               token: ${{ secrets.PAT }}
               branch: gh-pages # default: gh-pages
               folder: dist
               clean: true # Automatically remove deleted files from the deploy branch
     ```

     :::tip
     é¦–æ¬¡æ¨é€ä»£ç åï¼Œä¼šæ‰§è¡Œä¸€æ¬¡è‡ªåŠ¨éƒ¨ç½²ä¸”æŠ¥é”™ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè¿™æ˜¯å› ä¸º GitHub Actions ä¼šç›‘å¬ `.github/workflows` ç›®å½•çš„ `.yml` æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨é…ç½®äº†ä»¤ç‰Œåï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œ Actions äº†ã€‚
     :::

3. åˆ›å»ºä»¤ç‰Œ

   - æ‰“å¼€ GitHubï¼šå³ä¸Šè§’å¤´åƒ -> Settingsã€ä¸æ˜¯ä»“åº“çš„ Settings å“¦ï¼ã€‘ï¼›
   - å·¦ä¾§æœ€ä¸‹è¾¹çš„ Developer settings è¿›å…¥ï¼›
   - å±•å¼€ Personal access tokens -> Fine-grained tokensã€æ¨èä½¿ç”¨è¿™ä¸ªï¼Œè€Œä¸æ˜¯ Tokens(classic)ï¼ŒæŸ¥çœ‹[åŸå› ](https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)ã€‘ï¼›
   - ç‚¹å‡»å³ä¸Šè§’çš„ Generate new token æŒ‰é’®ï¼Œè¿›å…¥é…ç½®ç•Œé¢ï¼›
     ![Fine-grained tokens](/images/1715393860136.jpg){data-zoomable}
   - å¡«å†™ Token name ä¸º `generate for test auto pages`ï¼Œè¿™ä¸ªä»¤ç‰Œåç§°ä¸å¯ä»¥è·Ÿå…¶ä»–ä»¤ç‰Œçš„åç§°é‡å¤ï¼›
   - é€‰æ‹© Expirationï¼Œæœ€å¤šå¯ä»¥é€‰æ‹©ä¸€å¹´ï¼›
   - Repository access é€‰æ‹© `Only select repositories`ï¼Œç„¶åé€‰æ‹©éœ€è¦è‡ªåŠ¨éƒ¨ç½²çš„é¡¹ç›®ä»“åº“ï¼›
   - å°† Permissions ä¸­ Repository permissions çš„å…¨éƒ¨é€‰æ‹©éƒ½é€‰æ‹© `Read and write`ï¼Œæ²¡æœ‰è¯¥é€‰é¡¹çš„å°±é€‰æ‹© `Read-only`ï¼›
   - ç‚¹å‡» Generate token æŒ‰é’®ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªä»¤ç‰Œï¼Œå¤åˆ¶è¿™ä¸ªä»¤ç‰Œä¿å­˜å¥½ï¼Œåç»­éœ€è¦ç”¨åˆ°ã€å¦‚æœå¿˜è®°äº†ä»¤ç‰Œï¼Œå¯ä»¥åœ¨ä»¤ç‰Œè¯¦æƒ…é‡æ–°ç”Ÿæˆä¸€ä¸ªï¼Œä¸è¿‡ç”¨åˆ°è¯¥ä»¤ç‰Œçš„å…¨éƒ¨é¡¹ç›®éƒ½éœ€è¦åŒæ­¥æ›´æ–°ã€‘ã€‚

4. å°†ä»¤ç‰Œåº”ç”¨åœ¨ä»“åº“ä¸­

   - å›åˆ°ä»“åº“ä¸­ï¼šSettings -> Securityï¼›
   - å±•å¼€ Secrets and variablesï¼Œæ‰“å¼€ Actionsï¼›
   - åœ¨ Repository secrets å¤„ç»‘å®šä»¤ç‰Œï¼Œç‚¹å‡» `New repository secret` æŒ‰é’®ï¼›
   - åœ¨ `Name` å¡«å†™ `PAT`ã€è¿™ä¸ªå˜é‡ååœ¨ç¬¬ 2 æ­¥çš„ `auto-deploy.yml` æ–‡ä»¶ä¸­å¯è‡ªå®šä¹‰ã€‘ï¼›
   - åœ¨ `Secret` å¡«å†™ ä¸Šæ­¥åˆ›å»ºçš„ä»¤ç‰Œï¼›
   - ç‚¹å‡» `Add secret` æŒ‰é’®ä¿å­˜ã€‚

5. è¿è¡Œ Actionsï¼š

   - éšä¾¿æ¨é€ä»£ç åˆ° `master` åˆ†æ”¯ æˆ– æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ Actionsï¼Œä¸ºçš„æ˜¯è®© Actions å†è·‘ä¸€æ¬¡éƒ¨ç½²æµç¨‹ï¼›
   - æ‰“å¼€é¡¹ç›®ï¼šé¡¶éƒ¨ Actionsã€å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡æŠ¥é”™çš„éƒ¨ç½²ä¿¡æ¯ï¼Œè¿™å°±æ˜¯ä¸Šè¾¹è¯´çš„ï¼Œæˆ‘ä»¬ç¬¬ 2 æ­¥æ—¶è¿˜æ²¡æœ‰é…ç½®ä»¤ç‰Œï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‘ï¼›
   - ç‚¹å‡»è¿™æ¡æŠ¥é”™ workflow runï¼Œè¿›å…¥åç‚¹å‡»å³ä¸Šè§’çš„ `Re-run jobs` -> `Re-run all jobs`ï¼›
   - è¿™æ—¶å€™å¯ä»¥ç‚¹å‡»è¿›å…¥æŸ¥çœ‹éƒ¨ç½²è¿‡ç¨‹ï¼Œç­‰å¾… Complete job åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»“åº“æ–°å¢äº†ä¸€ä¸ª `gh-pages` åˆ†æ”¯ï¼Œä¸”é‡Œè¾¹çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æ‰“åŒ…åç”Ÿæˆçš„ `dist` æ–‡ä»¶å¤¹å†…å®¹ï¼›
   - è¿™æ—¶å€™æ‰“å¼€é¡¹ç›®ï¼šSettings -> Pagesï¼Œå°±ä¼šå‘ç° Build and deployment å·²ç»è‡ªåŠ¨å°† `gh-pages` åˆ†æ”¯éƒ¨ç½²å¥½äº†ï¼Œ[è®¿é—®ç¤ºä¾‹é¡¹ç›®](https://ele-cat.github.io/test-auto-pages/)ï¼›
   :::tip
   ä»¥åæ¯æ¬¡æ¨é€ `master` åˆ†æ”¯ä»£ç åï¼ŒActions éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œå®‰è£…ã€æ‰“åŒ…ã€éƒ¨ç½²ä»»åŠ¡ï¼Œå°†æœ€æ–°ä»£ç éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯;
   :::

## å‚è€ƒèµ„æ–™

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/zh/actions/quickstart)
- [vue3 - å‰ç«¯ Vue é¡¹ç›®æäº¤GitHub ä½¿ç”¨Actionsè‡ªåŠ¨åŒ–éƒ¨ç½²](https://blog.csdn.net/iotjin/article/details/133128159)
- [ä½¿ç”¨Github Actionså°†Vueé¡¹ç›®éƒ¨ç½²åˆ°Github Pages](https://www.cnblogs.com/xueyubao/p/13991935.html)
- [ä½¿ç”¨Github Actionsè‡ªåŠ¨éƒ¨ç½²vueé¡¹ç›®](https://blog.csdn.net/2302_77290281/article/details/133015530)